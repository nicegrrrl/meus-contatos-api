# Clients & Contacts

Esta API consiste em um cadastro de clientes que poder√° conter muitos contatos associados.

√â poss√≠vel realizar opera√ß√µes de cria√ß√£o, leitura, edi√ß√£o e dele√ß√£o de clientes e contatos.

üíª

## √çndice

- [Tecnologias e ferramentas](#1-tecnologias-e-ferramentas)
- [Primeiros passos](#2-primeiros-passos)
- [Diagrama de Relacionamento](#3-diagrama-de-relacionamento)
- [Rotas clients e login](#4-rotas-clients-e-login)
- [Regras de neg√≥cio das rotas clients e login](#5-regras-de-neg√≥cio-das-rotas-clients-e-login)
- [Rotas contacts](#6-rotas-contacts)
- [Regras de neg√≥cio das rotas contacts](#7-regras-de-neg√≥cio-das-rotas-contacts)

---

## 1. Tecnologias e ferramentas

[voltar para o √≠ndice](#√≠ndice)

- Express
- TypeScript
- PostgreSQL
- TypeORM
- Insomnia

---

## 2. Primeiros passos

[voltar para o √≠ndice](#√≠ndice)

1. Clone o reposit√≥rio em sua m√°quina.
2. Instale as depend√™ncias rodando o seguinte comando:

```shell
npm install
```

3. Crie um arquivo **.env**, seguindo os exemplos de vari√°veis de ambiente contidas no arquivo **.env.example**.
4. Gere as migra√ß√µes com o seguinte comando:

```shell
npm run typeorm:generate
```

5. Execute as migra√ß√µes com o seguinte comando:

```shell
npm run typeorm:run
```

6. Caso queira, voc√™ pode testar as rotas por meio da collection **insomnia_m6_desafio_fullstack**. Esse arquivo est√° localizado na raiz do projeto.
7. A API est√° prontinha para ser consumida. üòÑüöÄ

---

## 3. Diagrama de Relacionamento

[voltar para o √≠ndice](#√≠ndice)

![der](DER.png)

---

## 4. Rotas clients e login

[voltar para o √≠ndice](#√≠ndice)

| M√©todo | Endpoint           | Responsabilidade                  | Autentica√ß√£o                               |
| ------ | ------------------ | --------------------------------- | ------------------------------------------ |
| POST   | /clients           | Cria um cliente                   | N√£o necessita token                        |
| POST   | /login             | Gera o token de autentica√ß√£o      | N√£o necessita token                        |
| GET    | /clients           | Lista todos os clientes           | Apenas administradores                     |
| GET    | /clients/logged    | Lista dados do cliente logado     | Usu√°rio logado                             |
| GET    | /clients/:clientId | Lista um cliente por id           | Usu√°rio dono do contato ou administradores |
| PATCH  | /clients/:clientId | Atualiza um cliente               | Usu√°rio dono do contato ou administradores |
| DELETE | /clients/:clientId | Realiza um soft delete no cliente | Usu√°rio dono do contato ou administradores |

---

## 5. Regras de neg√≥cio das rotas clients e login

[voltar para o √≠ndice](#√≠ndice)

### POST /clients

Permite a cria√ß√£o de um novo cliente.

_Qualquer usu√°rio_ pode acessar a rota.

A chave **admin** n√£o √© obrigat√≥ria, sendo _false_ por padr√£o.

###### Corpo da requisi√ß√£o (Json)

```json
{
  "name": "Hayley Williams",
  "email": "hayley@mail.com",
  "password": "1234",
  "phoneNumber": "850"
}
```

###### Exemplo de resposta: status 201 Created

```json
{
  "id": 1,
  "name": "Hayley Williams",
  "email": "hayley@mail.com",
  "phoneNumber": "850",
  "admin": false,
  "registeredAt": "2024-01-24",
  "deletedAt": null
}
```

###### Corpo da requisi√ß√£o (Json)

```json
{
  "name": "Taylor Swift",
  "email": "taylor@mail.com",
  "password": "1234",
  "phoneNumber": "850",
  "admin": true
}
```

###### Exemplo de resposta: status 201 Created

```json
{
  "id": 2,
  "name": "Taylor Swift",
  "email": "taylor@mail.com",
  "phoneNumber": "850",
  "admin": true,
  "registeredAt": "2024-01-24",
  "deletedAt": null
}
```

###### Corpo da requisi√ß√£o (Json)

```json
{
  "name": "James Taylor",
  "email": "taylor@mail.com",
  "password": "1234",
  "phoneNumber": "850"
}
```

###### Exemplo de resposta (email existente): status 409 Conflict

```json
{
  "message": "Email already exists"
}
```

###### Corpo da requisi√ß√£o (Json)

```json
// sem corpo
```

###### Exemplo de resposta (requisi√ß√£o sem corpo): status 400 Bad Request

```json
{
  "message": {
    "name": ["Required"],
    "email": ["Required"],
    "password": ["Required"],
    "phoneNumber": ["Required"]
  }
}
```

---

### POST /login

Permite que o usu√°rio fa√ßa o login, gerando um token de autentica√ß√£o.

_Qualquer usu√°rio_ pode acessar a rota.

###### Corpo da requisi√ß√£o (Json)

```json
{
  "email": "hayley@mail.com",
  "password": "1234"
}
```

###### Exemplo de resposta: status 200 OK

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImhheWxleUBtYWlsLmNvbSIsImFkbWluIjpmYWxzZSwiaWF0IjoxNzA2MTE1MTE0LCJleHAiOjE3MDYyODc5MTQsInN1YiI6IjEifQ.pDssBE2cmhLqg_Q1Q5tCUkdXrv9vIhPACowMfpNVcPE"
}
```

###### Corpo da requisi√ß√£o (Json)

```json
{
  "email": "taylor@mail.com",
  "password": "12"
}
```

###### Exemplo de resposta (credenciais incorretas): status 401 Unauthorized

```json
{
  "message": "Invalid email or password"
}
```

---

### GET /clients

Lista todos os clientes cadastrados na aplica√ß√£o.

Apenas usu√°rios _administradores_ podem acessar essa rota.

###### Exemplo de resposta (administrador): status 200 OK

```json
[
  {
    "id": 1,
    "name": "Hayley Williams",
    "email": "hayley@mail.com",
    "phoneNumber": "850",
    "admin": false,
    "registeredAt": "2024-01-24",
    "deletedAt": null
  },
  {
    "id": 2,
    "name": "Taylor Swift",
    "email": "taylor@mail.com",
    "phoneNumber": "850",
    "admin": true,
    "registeredAt": "2024-01-24",
    "deletedAt": null
  },
  {
    "id": 3,
    "name": "teste",
    "email": "teste@mail.com",
    "phoneNumber": "850",
    "admin": false,
    "registeredAt": "2024-01-24",
    "deletedAt": null
  }
]
```

###### Exemplo de resposta (usu√°rio n√£o administrador): status 403 Forbidden

```json
{
  "message": "Insufficient permission"
}
```

###### Exemplo de resposta (usu√°rio n√£o logado): status 401 Unauthorized

```json
{
  "message": "Missing bearer token"
}
```

---

### GET /clients/logged

Retorna informa√ß√µes do usu√°rio logado.

Podem acessar essa rota usu√°rios _logados_.

###### Corpo da requisi√ß√£o (Json)

```json
// sem corpo
```

###### Exemplo de resposta (requisi√ß√£o sem corpo): status 400 Bad Request

```json
{
  "id": 2,
  "name": "Taylor Swift",
  "email": "taylor@mail.com",
  "phoneNumber": "850",
  "admin": true,
  "registeredAt": "2024-01-24",
  "deletedAt": null,
  "contacts": [
    {
      "id": 1,
      "name": "Olivia Rodrigo",
      "email": "olivia@mail.com",
      "phoneNumber": "900",
      "registeredAt": "2024-01-24",
      "deletedAt": null
    },
    {
      "id": 4,
      "name": "Olivia Rodrigo",
      "email": "olivia@mail.com",
      "phoneNumber": "900",
      "registeredAt": "2024-01-24",
      "deletedAt": null
    }
  ]
}
```

---

### GET /clients/:clientId

Lista um determinado cliente pelo seu id.

Podem acessar essa rota usu√°rios _administradores_ ou o _cliente logado_ detentor do referido id.

###### Exemplo de resposta: status 200 OK

```json
{
  "id": 1,
  "name": "Hayley Williams",
  "email": "hayley@mail.com",
  "phoneNumber": "850",
  "admin": false,
  "registeredAt": "2024-01-24",
  "deletedAt": null
}
```

###### Exemplo de resposta (usu√°rio sem permiss√£o): status 403 Forbidden

```json
{
  "message": "Insufficient permission"
}
```

###### Exemplo de resposta (usu√°rio n√£o logado): status 401 Unauthorized

```json
{
  "message": "Missing bearer token"
}
```

###### Exemplo de resposta (cliente n√£o encontrado): status 404 Not Found

```json
{
  "message": "Client not found"
}
```

---

### PATCH /clients/:clientId

Permite atualizar de forma parcial ou integral um determinado cliente pelo seu id.

Podem acessar essa rota usu√°rios _administradores_ ou o _cliente logado_ detentor do referido id.

###### Corpo da requisi√ß√£o (Json)

```json
{
  "name": "Usu√°rio de teste"
}
```

###### Exemplo de resposta: status 200 OK

```json
{
  "id": 3,
  "name": "Usu√°rio de teste",
  "email": "teste@mail.com",
  "phoneNumber": "850",
  "admin": false,
  "registeredAt": "2024-01-24",
  "deletedAt": null
}
```

###### Exemplo de resposta (usu√°rio sem permiss√£o): status 403 Forbidden

```json
{
  "message": "Insufficient permission"
}
```

###### Exemplo de resposta (usu√°rio n√£o logado): status 401 Unauthorized

```json
{
  "message": "Missing bearer token"
}
```

###### Exemplo de resposta (cliente n√£o encontrado): status 404 Not Found

```json
{
  "message": "Client not found"
}
```

---

### DELETE /clients/:clientId

Permite realizar um soft delete de um determinado cliente pelo seu id.

Podem acessar essa rota usu√°rios _administradores_ ou o _cliente logado_ detentor do referido id.

N√£o h√° corpo de requisi√ß√£o nem de resposta.

###### Exemplo de resposta: status 204 No Content

```json
// No body returned for response
```

###### Exemplo de resposta (usu√°rio n√£o logado): status 401 Unauthorized

```json
{
  "message": "Missing bearer token"
}
```

###### Exemplo de resposta (cliente n√£o encontrado): status 404 Not Found

```json
{
  "message": "Client not found"
}
```

---

## 6. Rotas contacts

[voltar para o √≠ndice](#√≠ndice)

| M√©todo | Endpoint                    | Responsabilidade                                    | Autentica√ß√£o                               |
| ------ | --------------------------- | --------------------------------------------------- | ------------------------------------------ |
| GET    | /contacts                   | Lista todos os contatos                             | Apenas administradores                     |
| POST   | /contacts                   | Cria um contato                                     | Usu√°rio logado ou administradores          |
| GET    | /contacts/clients/:clientId | Lista todas os contatos do usu√°rio logado           | Usu√°rio logado ou administradores          |
| GET    | /contacts/:contactId        | Lista um contato por id                             | Usu√°rio dono do contato ou administradores |
| PATCH  | /contacts/:contactId        | Atualiza o contato do usu√°rio logado                | Usu√°rio dono do contato ou administradores |
| DELETE | /contacts/:contactId        | Realiza um soft delete no contato do usu√°rio logado | Usu√°rio logado ou administradores          |

---

## 7. Regras de neg√≥cio das rotas contacts

[voltar para o √≠ndice](#√≠ndice)

### GET /contacts

Lista todos os contatos cadastrados na aplica√ß√£o, de todos os clientes.

Apenas usu√°rios _administradores_ podem acessar essa rota.

###### Exemplo de resposta: status 200 OK

```json
[
  {
    "id": 1,
    "name": "Olivia Rodrigo",
    "email": "olivia@mail.com",
    "phoneNumber": "900",
    "registeredAt": "2024-01-24",
    "deletedAt": null
  },
  {
    "id": 2,
    "name": "Zac Farro",
    "email": "zac@mail.com",
    "phoneNumber": "900123",
    "registeredAt": "2024-01-24",
    "deletedAt": null
  }
]
```

###### Exemplo de resposta (usu√°rio n√£o administrador): status 403 Forbidden

```json
{
  "message": "Insufficient permission"
}
```

###### Exemplo de resposta (usu√°rio n√£o logado): status 401 Unauthorized

```json
{
  "message": "Missing bearer token"
}
```

---

### POST /contacts

Permite criar um contato atrelado ao usu√°rio logado, seja ele um cliente comum ou um administrador.

Podem acessar essa rota usu√°rios _administradores_ ou _cliente logado_.

###### Corpo da requisi√ß√£o (Json)

```json
{
	{
	"name": "Olivia Rodrigo",
	"email": "olivia@mail.com",
	"phoneNumber": "900"
}
}
```

###### Exemplo de resposta: status 201 Created

```json
{
  "message": "Contact created"
}
```

###### Exemplo de resposta (usu√°rio n√£o logado): status 401 Unauthorized

```json
{
  "message": "Missing bearer token"
}
```

###### Corpo da requisi√ß√£o (Json)

```json
// sem corpo
```

###### Exemplo de resposta (requisi√ß√£o sem corpo): status 400 Bad Request

```json
{
  "message": {
    "name": ["Required"],
    "email": ["Required"],
    "phoneNumber": ["Required"]
  }
}
```

---

### GET /contacts/clients/:clientId

Lista todos os contatos criados pelo cliente logado detentor do id.

Podem acessar essa rota usu√°rios _administradores_ ou o _cliente logado_ detentor do referido id.

###### Exemplo de resposta: status 200 OK

```json
[
  {
    "id": 2,
    "name": "Zacccccc",
    "email": "zachw@email.com",
    "phoneNumber": "12345678",
    "registeredAt": "2024-01-24",
    "deletedAt": null
  },
  {
    "id": 3,
    "name": "Taylor York",
    "email": "tayloryork@mail.com",
    "phoneNumber": "900123",
    "registeredAt": "2024-01-24",
    "deletedAt": null
  }
]
```

###### Exemplo de resposta (usu√°rio sem permiss√£o): status 403 Forbidden

```json
{
  "message": "Insufficient permission"
}
```

###### Exemplo de resposta (usu√°rio n√£o logado): status 401 Unauthorized

```json
{
  "message": "Missing bearer token"
}
```

###### Exemplo de resposta (cliente n√£o encontrado): status 404 Not Found

```json
{
  "message": "Client not found"
}
```

---

### GET /contacts/:contactId

Lista um contato por id.

Podem acessar essa rota usu√°rios _administradores_ ou o _cliente logado_ que criou o contato.

###### Exemplo de resposta: status 200 OK

```json
{
  "id": 1,
  "name": "Olivia Rodrigo",
  "email": "olivia@mail.com",
  "phoneNumber": "900",
  "registeredAt": "2024-01-24",
  "deletedAt": null
}
```

###### Exemplo de resposta (contato n√£o encontrado): status 404 Not Found

```json
{
  "message": "Contact not found"
}
```

###### Exemplo de resposta (usu√°rio sem permiss√£o): status 403 Forbidden

```json
{
  "message": "Insufficient permission"
}
```

###### Exemplo de resposta (usu√°rio n√£o logado): status 401 Unauthorized

```json
{
  "message": "Missing bearer token"
}
```

---

### PATCH /contacts/:contactId

Atualiza de forma parcial ou integral o contato detentor do id que foi criado pelo usu√°rio logado.

Podem acessar essa rota usu√°rios _administradores_ ou o _cliente logado_ que criou o contato.

###### Corpo da requisi√ß√£o (Json)

```json
{
  "name": "Zach W. Farro",
  "email": "zachw@email.com",
  "phoneNumber": "12345678"
}
```

###### Exemplo de resposta: status 200 OK

```json
{
  "id": 2,
  "name": "Zach W. Farro",
  "email": "zachw@email.com",
  "phoneNumber": "12345678",
  "registeredAt": "2024-01-24",
  "deletedAt": null
}
```

###### Exemplo de resposta (usu√°rio sem permiss√£o): status 403 Forbidden

```json
{
  "message": "Insufficient permission"
}
```

###### Exemplo de resposta (usu√°rio n√£o logado): status 401 Unauthorized

```json
{
  "message": "Missing bearer token"
}
```

---

### DELETE /contacts/:contactId

Permite realizar um soft delete de um determinado contato criado pelo usu√°rio logado.

Podem acessar essa rota usu√°rios _administradores_ ou o _cliente logado_ que criou o contato.

N√£o h√° corpo de requisi√ß√£o nem de resposta.

###### Exemplo de resposta: status 204 No Content

```json
// No body returned for response
```

###### Exemplo de resposta (usu√°rio n√£o logado): status 401 Unauthorized

```json
{
  "message": "Missing bearer token"
}
```

###### Exemplo de resposta (contato n√£o encontrado): status 404 Not Found

```json
{
  "message": "Contact not found"
}
```

###### Exemplo de resposta (usu√°rio sem permiss√£o): status 403 Forbidden

```json
{
  "message": "Insufficient permission"
}
```
